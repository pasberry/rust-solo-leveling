# Rust WebAssembly Module for TypeScript

High-performance WASM module for web and Node.js, written in Rust.

## Features

- **Simple Functions**: greet, fibonacci, sum_array
- **Text Analysis**: Word/character/line counting with unique word detection
- **DataProcessor Class**: Stateful data analysis (mean, median, std dev)
- **Prime Numbers**: Prime checking and generation
- **String Hashing**: Simple hash function
- **User Processing**: Complex data structure handling with serde
- **Performance**: ~2-10x faster than JavaScript for CPU-intensive tasks

## Prerequisites

Install `wasm-pack`:

```bash
curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh
```

## Building

Build for different targets:

```bash
# For web bundlers (webpack, vite, rollup)
wasm-pack build --target bundler

# For Node.js
wasm-pack build --target nodejs

# For web (no bundler)
wasm-pack build --target web

# Release build (optimized)
wasm-pack build --target bundler --release
```

This creates a `pkg/` directory with:
- `rust_wasm_lib_bg.wasm` - The WebAssembly binary
- `rust_wasm_lib.js` - JavaScript wrapper
- `rust_wasm_lib.d.ts` - TypeScript type definitions
- `package.json` - NPM package metadata

## TypeScript Usage

### Initialization

```typescript
import init, { greet, fibonacci, DataProcessor } from './pkg/rust_wasm_lib';

async function main() {
  // Initialize WASM module
  await init();

  // Now you can use WASM functions
  console.log(greet('World'));
}

main();
```

### Functions

```typescript
// Simple greeting
const msg = greet('Alice');  // "Hello, Alice!"

// Fibonacci
const fib = fibonacci(20);  // 6765

// Sum array
const sum = sum_array(new Float64Array([1, 2, 3, 4, 5]));  // 15.0

// Text analysis
const stats = analyze_text("Hello world! Hello Rust!");
// { words: 4, characters: 24, lines: 1, unique_words: 3 }

// Prime checking
is_prime(17);  // true
is_prime(20);  // false

// Find primes
const primes = primes_up_to(50);
// [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47]

// String hashing
const hash = hash_string("hello");
```

### Classes

```typescript
// DataProcessor - stateful data analysis
const processor = new DataProcessor();

processor.add_data([10, 12, 15, 17, 18, 20, 22, 100]);

console.log(processor.len());       // 8
console.log(processor.mean());      // 26.75
console.log(processor.median());    // 17.5
console.log(processor.std_dev());   // 27.45

processor.clear();
console.log(processor.is_empty());  // true
```

### Complex Data

```typescript
// Process user data
const user = {
  name: 'Alice',
  email: 'alice@example.com',
  age: 30,
};

const result = process_user(user);
// "Alice (alice@example.com) is 30 years old"
```

## Running Example

```bash
# Install dependencies (if using bundler)
npm install

# Run with Node.js (after building for nodejs target)
node example/example.js

# Or use ts-node for TypeScript
npx ts-node example/example.ts
```

## Testing

Run Rust tests:

```bash
cargo test
```

Run WASM tests in browser:

```bash
wasm-pack test --headless --firefox
```

## Performance

The WASM module is significantly faster than JavaScript for CPU-intensive tasks:

```
Computing fibonacci(40) 100,000 times:
WASM: 245.32ms
JavaScript: 1,234.56ms
Speedup: 5.03x
```

## Type Definitions

TypeScript definitions are automatically generated by `wasm-pack`:

```typescript
export function greet(name: string): string;
export function fibonacci(n: number): number;
export function sum_array(numbers: Float64Array): number;
export function is_prime(n: number): boolean;
export function primes_up_to(n: number): Uint32Array;
export function hash_string(input: string): number;

export class DataProcessor {
  constructor();
  add_data(values: Float64Array): void;
  mean(): number;
  median(): number;
  std_dev(): number;
  clear(): void;
  len(): number;
  is_empty(): boolean;
  free(): void;
}
```

## Use Cases

- **Data Processing**: Large dataset analysis in the browser
- **Cryptography**: Hash functions, encryption algorithms
- **Image Processing**: Filters, transformations
- **Game Logic**: Physics calculations, pathfinding
- **Scientific Computing**: Statistical analysis, simulations
- **Text Processing**: Parsing, tokenization, compression

## Package Size

```bash
# Check WASM binary size
ls -lh pkg/rust_wasm_lib_bg.wasm

# Typical sizes:
# Debug: ~50-100KB
# Release: ~10-30KB (with opt-level="s")
```

## Integration Examples

### Webpack

```javascript
// webpack.config.js
module.exports = {
  experiments: {
    asyncWebAssembly: true,
  },
};
```

### Vite

```javascript
// vite.config.js
export default {
  optimizeDeps: {
    exclude: ['rust-wasm-lib'],
  },
};
```

## Tests

All 6 Rust unit tests pass:
- Fibonacci computation
- Array sum
- DataProcessor functionality
- Prime number checking
- Prime generation
- String hashing
